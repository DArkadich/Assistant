#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ RAG —Å–∏—Å—Ç–µ–º—É
"""

import os
import sys
sys.path.append('.')

from core.finances import *
from core.rag_system import rag_system

def create_test_documents():
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ RAG —Å–∏—Å—Ç–µ–º—ã."""
    
    print("üöÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è RAG —Å–∏—Å—Ç–µ–º—ã...")
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    test_docs = [
        {
            'type': '–∫–æ–Ω—Ç—Ä–∞–∫—Ç',
            'counterparty_name': '–û–û–û –¢–µ—Ö–Ω–æ–°–æ—Ñ—Ç',
            'amount': 500000,
            'date': '2024-01-15',
            'description': '–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–æ–º',
            'project': '–°–∫–ª–∞–¥–°–∏—Å—Ç–µ–º–∞',
            'extracted_text': '–î–æ–≥–æ–≤–æ—Ä –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–∫–ª–∞–¥—Å–∫–æ–≥–æ —É—á–µ—Ç–∞. –í–∫–ª—é—á–∞–µ—Ç –º–æ–¥—É–ª–∏ –ø—Ä–∏–µ–º–∞, –æ—Ç–≥—Ä—É–∑–∫–∏, –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏. –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è 3 –º–µ—Å—è—Ü–∞.'
        },
        {
            'type': '–Ω–∞–∫–ª–∞–¥–Ω–∞—è',
            'counterparty_name': '–ò–ü –ü–µ—Ç—Ä–æ–≤ –ê.–í.',
            'amount': 150000,
            'date': '2024-01-20',
            'description': '–ù–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
            'project': '–û—Ñ–∏—Å',
            'extracted_text': '–¢–æ–≤–∞—Ä–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É 5 –Ω–æ—É—Ç–±—É–∫–æ–≤ Dell, 3 –º–æ–Ω–∏—Ç–æ—Ä–∞ Samsung, 2 –ø—Ä–∏–Ω—Ç–µ—Ä–∞ HP. –û–ø–ª–∞—Ç–∞ –ø–æ —Ñ–∞–∫—Ç—É –ø–æ—Å—Ç–∞–≤–∫–∏.'
        },
        {
            'type': '—Å—á—ë—Ç',
            'counterparty_name': '–û–û–û –†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞',
            'amount': 75000,
            'date': '2024-02-01',
            'description': '–°—á–µ—Ç –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –ø–æ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–º—É —É—á–µ—Ç—É',
            'project': '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è',
            'extracted_text': '–°—á–µ—Ç –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –ø–æ –≤–µ–¥–µ–Ω–∏—é –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–≥–æ —É—á–µ—Ç–∞ –∑–∞ —è–Ω–≤–∞—Ä—å 2024 –≥–æ–¥–∞. –í–∫–ª—é—á–∞–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—é –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏.'
        },
        {
            'type': '–∞–∫—Ç',
            'counterparty_name': '–û–û–û –¢–µ—Ö–Ω–æ–°–æ—Ñ—Ç',
            'amount': 500000,
            'date': '2024-02-15',
            'description': '–ê–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è',
            'project': '–°–∫–ª–∞–¥–°–∏—Å—Ç–µ–º–∞',
            'extracted_text': '–ê–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–æ–º. –†–∞–±–æ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä–µ–º–µ –∏ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é.'
        },
        {
            'type': '–≥—Ç–¥',
            'counterparty_name': '–û–û–û –ò–º–ø–æ—Ä—Ç–¢—Ä–µ–π–¥',
            'amount': 300000,
            'date': '2024-02-20',
            'description': '–ì–¢–î –Ω–∞ –∏–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
            'project': '–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞',
            'extracted_text': '–ì—Ä—É–∑–æ–≤–∞—è —Ç–∞–º–æ–∂–µ–Ω–Ω–∞—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è –Ω–∞ –∏–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏–∑ –ö–∏—Ç–∞—è. –í–∫–ª—é—á–∞–µ—Ç 2 —Å–µ—Ä–≤–µ—Ä–∞ Dell PowerEdge, —Å–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ Cisco.'
        },
        {
            'type': '—É–ø–¥',
            'counterparty_name': '–ò–ü –°–∏–¥–æ—Ä–æ–≤–∞ –ï.–ú.',
            'amount': 45000,
            'date': '2024-03-01',
            'description': '–£–ü–î –∑–∞ —É—Å–ª—É–≥–∏ –ø–æ –¥–∏–∑–∞–π–Ω—É –ª–æ–≥–æ—Ç–∏–ø–∞ –∏ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–≥–æ —Å—Ç–∏–ª—è',
            'project': '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥',
            'extracted_text': '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞ —É—Å–ª—É–≥–∏ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –¥–∏–∑–∞–π–Ω–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–≥–æ —Å—Ç–∏–ª—è. –í–∫–ª—é—á–∞–µ—Ç –º–∞–∫–µ—Ç—ã –¥–ª—è –ø–µ—á–∞—Ç–∏ –∏ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.'
        },
        {
            'type': '–∫–æ–Ω—Ç—Ä–∞–∫—Ç',
            'counterparty_name': '–û–û–û –ú–∞—Ä–∫–µ—Ç–ü–ª—é—Å',
            'amount': 200000,
            'date': '2024-03-10',
            'description': '–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏',
            'project': '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥',
            'extracted_text': '–î–æ–≥–æ–≤–æ—Ä –Ω–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏. –í–∫–ª—é—á–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤ –°–ú–ò –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö.'
        },
        {
            'type': '–Ω–∞–∫–ª–∞–¥–Ω–∞—è',
            'counterparty_name': '–û–û–û –û—Ñ–∏—Å–ú–∞—Ä–∫–µ—Ç',
            'amount': 25000,
            'date': '2024-03-15',
            'description': '–ù–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤',
            'project': '–û—Ñ–∏—Å',
            'extracted_text': '–¢–æ–≤–∞—Ä–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤: –±—É–º–∞–≥–∞ –ê4, —Ä—É—á–∫–∏, –±–ª–æ–∫–Ω–æ—Ç—ã, –ø–∞–ø–∫–∏, —Å—Ç–µ–ø–ª–µ—Ä—ã. –î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ—Ñ–∏—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.'
        }
    ]
    
    # –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã
    for i, doc_data in enumerate(test_docs, 1):
        try:
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
            doc_id = f"test_{doc_data['type']}_{i}_{int(os.urandom(4).hex(), 16)}"
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ JSON
            document = {
                'id': doc_id,
                'type': doc_data['type'],
                'counterparty_name': doc_data['counterparty_name'],
                'amount': doc_data['amount'],
                'date': doc_data['date'],
                'description': doc_data['description'],
                'project': doc_data['project'],
                'created_at': '2024-01-01T00:00:00',
                'drive_file_id': None,
                'extracted_text': doc_data['extracted_text'],
                'keywords': [doc_data['type'], doc_data['project'], doc_data['counterparty_name']]
            }
            
            documents.append(document)
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ RAG —Å–∏—Å—Ç–µ–º—É
            rag_content = f"{doc_data['type']} {doc_data['counterparty_name']} {doc_data['description']} {doc_data['extracted_text']}"
            
            rag_metadata = {
                'type': doc_data['type'],
                'counterparty_name': doc_data['counterparty_name'],
                'amount': str(doc_data['amount']),
                'date': doc_data['date'],
                'project': doc_data['project'],
                'drive_file_id': '',
                'has_extracted_text': 'yes'
            }
            
            rag_system.add_document(doc_id, rag_content, rag_metadata)
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç {i}: {doc_data['type']} - {doc_data['counterparty_name']}")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ {i}: {e}")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ JSON
    save_doc()
    
    print(f"\nüéâ –°–æ–∑–¥–∞–Ω–æ {len(test_docs)} —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤!")
    print("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ RAG —Å–∏—Å—Ç–µ–º—ã:")
    stats = rag_system.get_collection_stats()
    print(f"   - –í—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {stats.get('total_documents', 0)}")
    print(f"   - –ö–æ–ª–ª–µ–∫—Ü–∏—è: {stats.get('collection_name', 'N/A')}")
    print(f"   - –°—Ç–∞—Ç—É—Å: {stats.get('status', 'N/A')}")

if __name__ == "__main__":
    create_test_documents() 